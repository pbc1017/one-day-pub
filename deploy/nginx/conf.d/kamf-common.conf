# Upstream 정의 - 공통 설정

# 운영환경 upstream
upstream one_day_pub_prod_api {
    server one-day-pub-api:8000;
    # 향후 스케일링 시 추가 서버들
    # server one-day-pub-api-2:8000;
}

upstream one_day_pub_prod_web {
    server one-day-pub-web:3000;
    # 향후 스케일링 시 추가 서버들
    # server one-day-pub-web-2:3000;
}

# 개발환경 upstream
upstream one_day_pub_dev_api {
    server one-day-pub-dev-api:8000;
}

upstream one_day_pub_dev_web {
    server one-day-pub-dev-web:3000;
}

# WebSocket 업그레이드를 위한 맵
map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

# 공통 프록시 설정을 위한 맵
map $scheme $proxy_x_forwarded_proto {
    default $scheme;
    https https;
}
