# 일일호프 SSOT (Single Source of Truth)

> 최종 업데이트: 2025-10-22 (자유석 타임 선택 추가, 미팅석 2인 필수)  
> 이 문서는 일일호프 프로젝트의 유일한 진실 공급원(Single Source of Truth)입니다.

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [행사 정보](#행사-정보)
3. [타임 구성](#타임-구성)
4. [좌석 구성 및 인원 제한](#좌석-구성-및-인원-제한)
5. [참가비 및 결제 정보](#참가비-및-결제-정보)
6. [신청 플로우](#신청-플로우)
7. [데이터 수집 및 검증](#데이터-수집-및-검증)
8. [비즈니스 규칙](#비즈니스-규칙)
9. [개인정보 처리 방침](#개인정보-처리-방침)
10. [인증 및 보안](#인증-및-보안)
11. [시스템 URL](#시스템-url)

---

## 프로젝트 개요

### 프로젝트명

**CNU & KAIST 일일호프 w. 하루해**

### 목적

충남대학교와 KAIST 학생들이 함께 참여하는 소셜 네트워킹 이벤트

### 참여 대상

- KAIST 학부생 (재학생, 휴학생 포함)
- 충남대학교 학부생 (재학생, 휴학생 포함)
- **미성년자 신청 불가**

---

## 행사 정보

### 일시

- **날짜**: 2025년 11월 11일 (월요일)
- **입장 시작**: 18:00

### 장소

- **위치**: 궁동 로데오거리 하루해
- **지도**: https://naver.me/x7vB70tH
- **사용 공간**:
  - 홀 (왼쪽 아래 회식 박스 공간)
  - 미팅룸 (오른쪽 벽 4인석)

### 이벤트

- **사연 라디오**: 릴스 댓글 + 현장 사연으로 진행
- **빼빼로 테마 게임**: 빼빼로를 이용한 미니게임
- **이벤트 시간**: 매시 11분마다

---

## 타임 구성

### 1타임

- **시간**: 19:00 ~ 21:00 (2시간)
- **미팅석**: 36명 (학교별/성별 제한 있음)
- **자유석**: 56명 (남녀 각 28명)

### 2타임

- **시간**: 22:00 ~ 24:00 (2시간)
- **미팅석**: 36명 (학교별/성별 제한 있음)
- **자유석**: 56명 (남녀 각 28명)

> ⚠️ **변경 이력**: 초기 계획 21:30~23:30에서 22:00~24:00으로 변경됨 (2025-10-17)

---

## 좌석 구성 및 인원 제한

### 미팅석 (Meeting Seat)

#### 특징

- 학교/성별/타임별 인원 제한
- 좌석 자동 배정 (신청자가 직접 선택 불가)
- **2명 단위로만 신청 가능 (1인 신청 불가)**
- **동성만 가능 (남녀 혼성 금지)**

#### 타임당 인원 제한

각 타임별로 다음과 같이 인원 제한:

| 학교     | 성별 | 인원     |
| -------- | ---- | -------- |
| KAIST    | 남성 | 10명     |
| KAIST    | 여성 | 8명      |
| 충남대   | 남성 | 8명      |
| 충남대   | 여성 | 10명     |
| **합계** |      | **36명** |

### 자유석 (General Seat / 홀석)

#### 특징

- 타임 선택 필수 (1타임 또는 2타임)
- 신청자가 직접 좌석 선택
- 좌석 배치 후 성별에 따라 색상 표시
  - 남성: 파란색
  - 여성: 핑크색

#### 좌석 구성

- **6인석**: 4테이블 = 24석
- **4인석**: 8테이블 = 32석
- **총 56석**

#### 타임당 인원 제한

- **남성**: 28명
- **여성**: 28명
- **학교 구분 없음** (충남대/KAIST 합산하여 성별만 제한)

---

## 참가비 및 결제 정보

### 참가비

- **일반석 (1인)**: 10,000원
- **미팅석 (2인)**: 20,000원 (1인당 10,000원)

### 계좌 정보

#### KAIST 학생

- **은행**: 우리은행
- **계좌번호**: 1005 503 378179
- **예금주**: 한국과학기술원(KAIST)
- **입금자명 형식**: [학번 끝자리] + [이름]
  - 예시: `234홍길동` (학번이 20251234인 경우)

#### 충남대학교 학생

- **상태**: ⚠️ **미확정**
- **사유**: 계좌 개설을 위해 감사원 심사 필요 (사업계획서 필요)

### 입금 규정

- **입금 기한**: 신청 당일 23:59까지
- **미입금 처리**: 다음날 09:00 자동 취소
- **입금 확인**: 영업일 기준 1~2일 소요
- **확인 방법**: 이메일로 확인 메시지 발송

### 환불 규정

- **환불 가능 기간**: 행사 7일 전까지
- **환불 방법**: 학생회 메일로 연락
- **환불 마감일**: 2025년 10월 31일 전까지

---

## 신청 플로우

### 1단계: 기본 정보 선택

신청자가 다음 정보를 선택:

- **학교**: KAIST / 충남대학교 (계좌 정보 표시용)
- **성별**: 남성 / 여성
- **좌석 유형**: 미팅석 / 자유석
- **타임**: 1타임 (19:00~21:00) / 2타임 (22:00~24:00)

> ⚠️ **미팅석은 2명 단위로만 신청 가능**

### 2단계: 이메일 인증 ⭐ **NEW**

#### 이메일 입력 및 인증

1. 이메일 주소 입력
2. "인증 코드 발송" 버튼 클릭
3. 입력한 이메일로 6자리 인증 코드 수신 (유효시간: 10분)
4. 인증 코드 입력 및 확인
5. 인증 완료 시 다음 단계 진행 가능

#### 중복 신청 확인

- 이미 신청한 이메일인 경우 신청 불가
- 한 이메일당 하나의 신청만 허용 (PENDING/PAYMENT_CONFIRMED 상태)
- 취소(CANCELLED)한 경우 재신청 가능

### 3단계: 개인정보 수집 및 이용 동의

- 개인정보 수집·이용 동의서 확인
- 필수 동의 (동의하지 않으면 신청 불가)

### 4단계: 개인정보 입력

#### 신청자 정보 (필수)

- 이름
- 학과
- 학번 (전체 학번)
- 생년 (YYYY 형식, 4자리)
- 전화번호 (010-XXXX-XXXX)

#### 동반인 정보 (미팅석 선택 시 필수)

- 이름
- 학과
- 학번
- 생년
- 전화번호

> 미팅석은 2명 단위로만 신청 가능하므로 동반인 정보 필수

### 5단계: 좌석 선택 (자유석만)

- 좌석 배치도에서 선택 가능한 좌석 확인
- 원하는 좌석 선택
- **미팅석은 이 단계를 건너뜀** (자동 배정)

### 6단계: 입금 안내

- 학교에 따른 계좌 정보 표시
- 입금자명 안내
- 입금 기한 안내
- 신청 정보 요약 표시
- 신청 완료
- **신청 완료 이메일 발송** (로그인 링크 포함)

---

## 데이터 수집 및 검증

### 학번 형식

#### KAIST

- **자릿수**: 8자리
- **형식**: 숫자만
- **예시**: `20251234`

#### 충남대학교

- **자릿수**: 9자리
- **형식**: 숫자만
- **예시**: `202201423`
- **설명**: 입학년도(4자리) + 학과코드 + 일련번호

### 이메일 정책

#### KAIST

- **도메인**: `@kaist.ac.kr`
- **검증**: 학교 이메일로 인증 가능

#### 충남대학교

- **학교 이메일**: `@cnu.ac.kr` (학생은 미사용, 교수만 사용)
- **정책**: 개인 이메일 사용 허용
- **검증**: 이메일 인증으로 본인 확인

### 생년 검증

- **형식**: YYYY (4자리 숫자)
- **예시**: `2000`, `2001`
- **목적**: 미성년자 여부 확인

### 전화번호 검증

- **형식**: `010-XXXX-XXXX` 또는 `01012345678`
- **정규식**: `^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$`

---

## 비즈니스 규칙

### 신청 제한 규칙

#### 미팅석

1. **2명 단위 신청 필수**
   - 1명 단위 신청 불가
   - 반드시 동반인 정보 입력 필요

2. **동성만 가능**
   - 남녀 혼성 신청 차단
   - 프론트엔드에서 검증 필요

3. **타임별 학교/성별 인원 제한**
   - 제한 인원 도달 시 해당 조합 신청 불가
   - 예: KAIST 남성 1타임 10명 도달 시 추가 신청 차단

4. **좌석 자동 배정**
   - 관리자가 행사 전 좌석 배정
   - 신청자는 좌석 선택 불가

#### 자유석

1. **타임 선택 필수**
   - 1타임 또는 2타임 선택 필요
   - 타임별로 좌석이 분리되어 관리됨

2. **타임별 성별 인원 제한**
   - 각 타임마다 남성/여성 각 28명까지
   - 학교 구분 없이 전체 성별로만 제한

3. **좌석 중복 방지**
   - 동일 좌석 동시 선택 방지
   - 선택된 좌석은 실시간으로 다른 사용자에게 비활성화

4. **좌석 색상 표시**
   - 선택 완료된 좌석: 성별에 따라 파란색(남) / 핑크색(여)

### 입금 및 확정 규칙

1. **입금 기한**
   - 신청 당일 23:59까지 입금
   - 시간 초과 시 다음날 09:00 자동 취소

2. **입금 확인**
   - 관리자가 수동 확인
   - 확인 완료 후 이메일 발송

3. **좌석 확정**
   - 입금 확인 후 좌석 최종 확정
   - 미입금 시 좌석 자동 해제

---

## 개인정보 처리 방침

### 수집하는 개인정보 항목

#### 필수 항목

- 이름
- 학교
- 학과
- 학번
- 생년
- 성별
- 전화번호
- 이메일

#### 선택 항목

- 좌석 선택 정보
- 입장 타임 정보

### 개인정보의 수집 및 이용 목적

1. 일일호프 참가 신청 접수 및 확인
2. 참가자 본인 확인 및 신원 확인
3. 참가비 입금 확인 및 좌석 배정
4. 행사 관련 공지사항 전달
5. 행사 통계 및 분석

### 개인정보의 보유 및 이용 기간

- **보유 기간**: 행사 종료 후 30일
- **파기**: 보유 기간 종료 후 즉시 파기
- **예외**: 관계 법령에 따라 보존이 필요한 경우 해당 기간 동안 보관

### 개인정보 제공 동의 거부 권리

- 정보 제공 동의 거부 가능
- 단, 필수 항목 동의 거부 시 서비스 이용 제한

---

## 인증 및 보안

### 신청 시

1. **이메일 인증 필수**
   - 신청 전 이메일 주소 인증 필요
   - 6자리 인증 코드 발송 및 확인
   - 인증 후 30분 이내 신청 완료 필요

2. **User 계정 자동 생성**
   - 신청 완료 시 자동으로 User 계정 생성 (role: APPLICANT)
   - 이메일 기준으로 User 관리
   - 로그인 없이 신청 완료

### 조회/수정/취소 시

1. **로그인 필요**
   - 이메일 입력 후 인증 코드 발송
   - 6자리 코드 확인
   - Access Token + Refresh Token 발급 (30일 유효)

2. **가능한 작업**
   - 내 신청 내역 조회
   - 입금 상태 확인 (PENDING → PAYMENT_CONFIRMED)
   - 신청 정보 수정 (좌석 변경, 개인정보 수정)
   - 신청 취소

3. **보안**
   - 본인 신청만 조회/수정/취소 가능
   - JWT 기반 인증
   - Refresh Token Rotation (갱신 시 새 토큰 발급)

### 관리자

1. **이메일 인증 로그인**
   - 비밀번호 없이 이메일 인증만으로 로그인
   - 관리자 이메일로 6자리 코드 발송
   - Access Token + Refresh Token 발급

2. **관리자 권한**
   - SUPER_ADMIN: 모든 기능
   - ADMIN: 일반 관리 기능

### 데이터 저장

- 로컬스토리지에 임시 저장 (페이지 새로고침 시 복원)
- 키: `onedaypub_registration`
- 이메일 인증 상태: `emailVerified: true`
- 신청 완료 시: `onedaypub_registration_completed` 플래그 설정

### JWT 토큰

1. **Access Token**
   - 유효기간: 15분
   - API 요청 인증
   - 메모리에 저장

2. **Refresh Token**
   - 유효기간: 30일
   - Access Token 갱신용
   - HttpOnly Cookie 또는 Secure Storage
   - Rotation 적용 (재사용 방지)

---

## 시스템 URL

### 개발 환경

- **URL**: https://dev.one-day-pub.site/
- **용도**: 개발 및 테스트
- **공개**: 외부 노출 금지

### 프로덕션 환경

- **URL**: https://one-day-pub.site/
- **용도**: 실제 서비스
- **공개**: 2025년 10월 24일 업로드 예정

---

## 개발 일정

- **개발 시작**: 2025년 10월 16일
- **내부 테스트**: 2025년 10월 22일 (수요일 오전)
- **서비스 오픈**: 2025년 10월 24일 (금요일)
- **행사 당일**: 2025년 11월 11일

---

## 변경 이력

| 날짜       | 항목               | 변경 내용                          | 사유                        |
| ---------- | ------------------ | ---------------------------------- | --------------------------- |
| 2025-10-17 | 2타임 시간         | 21:30~23:30 → 22:00~24:00          | 충남대 협의 결과            |
| 2025-10-17 | 미팅석 신청 플로우 | 좌석 선택 → 자동 배정으로 변경     | 운영 효율성                 |
| 2025-10-19 | 미팅석 2인 신청    | 남녀 혼성 금지 추가                | 행사 취지 반영              |
| 2025-10-19 | 자유석 성별 제한   | 학교 구분 없이 전체 남녀 비율 제한 | 성비 균형                   |
| 2025-10-20 | KAIST 계좌 정보    | 계좌 정보 확정                     | 전략기획국 확인             |
| 2025-10-22 | 자유석 타임 선택   | 자유석도 타임 선택 필수로 변경     | 타임별 좌석 관리            |
| 2025-10-22 | 미팅석 인원 제한   | 1명 신청 제거, 2명만 신청 가능     | 미팅 취지 강화              |
| 2025-10-22 | 이메일 인증 추가   | 신청 전 이메일 인증 필수           | 중복 신청 방지 및 본인 확인 |
| 2025-10-22 | 로그인 시스템      | 신청 조회/수정/취소용 로그인 추가  | 사용자 신청 관리 기능       |
| 2025-10-22 | User 기반 설계     | Admin + Applicant 통합 User 테이블 | 시스템 일관성 향상          |

---

## 미확정 사항

### 충남대학교 계좌 정보

- **상태**: 미확정
- **사유**: 계좌 개설을 위해 감사원 심사 필요
- **필요 서류**: 사업계획서 (프로그램 포함)
- **대응**: 일단 계좌 정보 없이 시스템 구축 진행

---

## 참고 사항

### UI/UX

- **메인 컬러**: 핑크 (#E53C87, #F06292), 검정 (#0a0a0a)
- **컨셉**: 설레는 핑크, 귀여운 느낌
- **안내 멘트**: 수정 용이하도록 설계 (하드코딩 지양)

### 기술 스택

- **프론트엔드**: Next.js, TypeScript, Tailwind CSS
- **백엔드**: NestJS, TypeScript
- **데이터베이스**: MySQL (TypeORM)
- **배포**: K8s (dev/prod 환경 분리)

---

_이 문서는 일일호프 프로젝트의 Single Source of Truth입니다. 모든 개발 및 운영 결정은 이 문서를 기준으로 합니다._
